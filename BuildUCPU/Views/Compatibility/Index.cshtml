@{
    ViewData["Title"] = "Podsumowanie";
    string data = Context.Request.Query["data"]; // Użycie Context.Request
    decimal totalPrice = 0;
}

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podsumowanie</title>
    <style>
        th, td {
            text-align: left;
            padding: 10px;
            border: 1px solid #ddd;
        }

        table {
            width: 100%;
            margin-top: 20px;
        }

        .summary {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>Podsumowanie Wybranych Podzespołów</h2>

    @if (!string.IsNullOrEmpty(data))
    {
        var components = data.Split(';');
        <table>
            <thead>
                <tr>
                    <th>Producent</th>
                    <th>Model</th>
                    <th>Cena</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var component in components)
                {
                    if (!string.IsNullOrWhiteSpace(component))
                    {
                        var parts = component.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                        if (parts.Length >= 3)
                        {
                            var producer = parts[0]; // Producent to pierwszy element
                            var priceText = parts[^2].Replace("zł", "").Replace(",", ".").Replace(" ", "").Trim(); // Cena jako przedostatni element
                            var modelParts = parts[1..^2]; // Wszystko pomiędzy producentem a ceną
                            var modelName = string.Join(" ", modelParts); // Połączenie wszystkich części modelu

                            decimal price = 0;
                            if (decimal.TryParse(priceText, System.Globalization.NumberStyles.AllowDecimalPoint, System.Globalization.CultureInfo.InvariantCulture, out price))
                            {
                                totalPrice += price;
                            }

                            <tr>
                                <td>@producer</td>
                                <td>@modelName</td>
                                <td>@price zł</td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>

        <div class="summary">
            Łączna cena: @totalPrice zł
        </div>
    }
    else
    {
        <p>Nie przekazano żadnych danych do podsumowania.</p>
    }
</body>
</html>
